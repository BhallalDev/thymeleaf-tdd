{"name":"Thymeleaf-tdd","tagline":"Test Driven Development framework for Thymeleaf and Thymesheet","body":"thymeleaf-tdd\r\n=============\r\n\r\nTest Driven Development framework for Spring with Thymeleaf and Thymesheet.\r\n\r\n## Maven\r\n\r\nInclude the latest release from Maven,\r\n\r\n\t\t<dependency>\r\n\t\t\t<groupId>com.connect-group</groupId>\r\n\t\t\t<artifactId>thymeleaf-tdd</artifactId>\r\n\t\t\t<version>1.0.0</version>\r\n\t\t\t<scope>test</scope>\r\n\t\t</dependency>\r\n\r\nThymeleaf-TDD makes use of the full Hamcrest suite (version 1.3), and JUnit 4.11; these will be pulled in as dependancies when you include thymeleaf-tdd.\r\n\r\n\r\n## What is Thymeleaf?\r\nThymeleaf is a Java library. It is an XML / XHTML / HTML5 template engine (extensible to other formats) that can work both in web and non-web environments, best suited for serving XHTML/HTML5.\r\n\r\nIt provides an optional module for integration with Spring MVC, so that you can use it as a complete substitute of JSP in your applications made with this technology, even with HTML5.\r\n\r\nThe main goal of Thymeleaf is to provide an elegant and well-formed way of creating powerful natural templates that can be correctly displayed by browsers and therefore work also as static prototypes. \r\n\r\nFor more detail, see http://www.thymeleaf.org/\r\n\r\n## What about Thymeleaf Testing?\r\n* https://github.com/thymeleaf/thymeleaf-testing\r\nThymeleaf Testing is an alternative (and the original) method of testing Thymeleaf.  It will also work with Thymesheet, if required.\r\nFor Test Driven Development however it was not quite flexible enough: it will allow you to generate an HTML page and perform a \"diff\" against an expected outcome, which is perfect for many scenarios.  However it does not fit well with TDD where we run a series of independant tests.  \r\n\r\nSo for occassions where the standard test package is not appropriate, or you would prefer to go with a more traditional JUnit approach, thymeleaf-tdd may be a candidate.\r\n\r\n## What is TDD?\r\nTest Driven Development simply put involves writing a test, then writing code that causes the test to pass.  \r\n\r\n1. RED BAR: Write, and run, a behaviour specification (test) that fails.\r\n2. GREEN BAR: Code just enough to meet the specification. Code and test until it passes.\r\n3. Refactor, Retest\r\n\r\nNote that writing some code, then adding a test, is NOT TDD.\r\n\r\nTDD is a best practice in software development.\r\n\r\nFor more information, see\r\n\r\n* http://www.jamesshore.com/Agile-Book/test_driven_development.html\r\n* http://dannorth.net/introducing-bdd/\r\n\r\n## What can you test?\r\nUsing the Thymeleaf-TDD project you can develop and test Thymeleaf custom attribute processors, and Thymeleaf HTML pages.  This provides a way to use TDD to develop HTML with Thymeleaf attributes without running Tomcat or any other servlet container.  It also provides support for TDD of Thymesheet - where the Thymeleaf attributes are separated into an external CSS3 style file.\r\n\r\n\r\n\r\n## Example\r\nFirst, you must create a JUnit test class which runs with SpringJUnit4ClassRunner, and uses the default SpringContext supplied with thymeleaf-tdd.  You can create your own Spring configuration required - if you need to scan for beans, for example or customise the spring environment for any reason.  The default Spring configuration uses LEGACYHTML5 but this is easily changed by adding a property to /src/test/resources/test.properties - more on that later.\r\n\r\nSo an empty JUnit test class appears as follows,\r\n\r\n    import org.junit.Test;\r\n    import org.junit.runner.RunWith;\r\n    import org.springframework.beans.factory.annotation.Autowired;\r\n    import org.springframework.test.context.ContextConfiguration;\r\n    import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;\r\n    import com.connect_group.thymeleaf.testing.config.ThymesheetTestSpringContext;\r\n    \r\n    @RunWith(SpringJUnit4ClassRunner.class)\r\n    @ContextConfiguration(classes = { ThymesheetTestSpringContext.class })\r\n    public class SampleUnitTest {\r\n        @Autowired\r\n        private ThymeleafTestEngine testEngine;\r\n    }\r\n\r\n\r\nTo begin with, imagine you have been supplied a HTML file by your frontend development team.  (Or that you have developed it yourself).\r\n\r\n    <html>\r\n      <head>\r\n        <title>Lorem Ipsum</title>\r\n      </head>\r\n      <body>\r\n        <h1>A heading</h1>\r\n        <p>Some text</p>\r\n        <p>Some more text</p>\r\n        \r\n        <h2>A sub-heading</h2>\r\n        <p>Sub text</p>\r\n        <p>More sub text</p>\r\n        <a href=\"http://www.example.com/\">A Link</a>\r\n      </body>\r\n    </html>\r\n\r\nThis can be placed in your webapp - wherever you would normally place your HTML files.  For example, /src/main/webapp/html/test.html\r\n\r\n\r\n\r\n\r\n### Should Set Title To Expected Value\r\nThe first thing we need to do is change the HTML page title \"Lorem Ipsum\", to something dynamic, perhaps supplied by a CMS for example.  In a Spring controller we would add a key/value pair to the ModelAndView object.  But we are testing in isolation of the controller, so we have to create our own Map<String,?> to represent the model.\r\n\r\nSo our first test would look something like this,\r\n\r\n    @Test\r\n    public void shouldSetTitleToExpectedValue() throws Exception {\r\n      Map<String,Object> model = new HashMap<String,Object>();\r\n      model.put(\"pageTitle\", \"expected title\");\r\n      HtmlElements tags = testEngine.process(\"/html/test.html\", model);\r\n      assertThat(tags.matching(\"title\"), isSingleElementThat(hasOnlyText(\"expected title\")));\r\n    }\r\n\r\nNow run the tests; e.g. if your IDE is Eclipse, use the JUnit view to run the test; or from the command line type \"mvn test\".\r\n\r\nThe test will fail because we have not added the Thymeleaf tag to the HTML yet!  Great - we got a \"Red Bar\".\r\n\r\nNow we have to update the title by adding in a data-th-text attribute.\r\n\r\n        <title data-th-text=\"${pageTitle}\">Lorem Ipsum</title>\r\n\r\nSave the file, run the test: Green bar!  We have written our first unit test.\r\n\r\n### Should Set Heading To Expected Value\r\nSimilarly the \"H1\" can be set by first writing a test to set the heading, \r\n\r\n    @Test\r\n    public void shouldSetHeadingToExpectedValue() throws Exception {\r\n      Map<String,Object> model = new HashMap<String,Object>();\r\n      model.put(\"heading1\", \"expected heading 1\");\r\n      HtmlElements tags = testEngine.process(\"/html/test.html\", model);\r\n      assertThat(tags.matching(\"h1\"), isSingleElementThat(hasOnlyText(\"expected heading 1\")));\t\t\r\n    }\r\n\r\n... this will fail when run.  Then add in the attribute for the heading,\r\n\r\n        <h1 data-th-text=\"${heading1}\">A heading</h1>\r\n\r\n... run the test again, and you get a Green bar.  Success!\r\n\r\nNormally in TDD you should refactor after each test.  In this case there is very little to refactor; however, the tests themselves should be tidied up as we are creating a HashMap in every test, and using the same path \"/html/test.html\".\r\n\r\n### Should Create Three Paragraphs Under Heading 1\r\nNext lets add in something a little more difficult: We will create paragraphs based upon a list of strings.  For those familiar with Thymeleaf, this means using the data-th-each attribute.\r\n\r\n    @Test\r\n    public void shouldCreateThreeParagraphsUnderHeading1() throws Exception {\r\n      Map<String,Object> model = new HashMap<String,Object>();\r\n      model.put(\"section1Paragraphs\", Arrays.asList(\"para 1\", \"para 2\", \"para 3\"));\r\n      HtmlElements tags = testEngine.process(\"/html/test.html\", model);\r\n      assertThat(tags.matching(\"h1~p\").size() - tags.matching(\"h2~p\").size(), equalTo(3)); \t\t\r\n    }\r\n\r\nThe test above finds tags matching \"h1 ~ p\".  This means, find all \"P\" tags which are siblings of H1 and which come after the H1 element.  Similarly, \"h2 ~ p\" means find all \"P\" tags which are siblings of H2 and which follow the H2 tag.  We can calculate the number of P tags after the H1 but before the H2 by subtracting.\r\n\r\nSo the test above creates a list of 3 paragraphs, then tests to see if 3 paragraphs are output.\r\n\r\nRun the test - and as expected we get a red bar.  The error message reads, \"Expected 3 but was 2\".\r\n\r\nOK - we havent yet added in the code, so lets do that.\r\n\r\n        <p data-th-each=\"para : ${section1Paragraphs}\">Some text</p>\r\n        <p>Some more text</p>\r\n\r\nRun the test - and we get another red bar.  This time the error message reads, \"Expected 3 but was 4\".  If you are stuck at this point you could 'cheat' -- take a look at the HTML that is being created.  There are a couple of ways to do this.\r\n\r\n1. String output = testEngine.toString(\"/html/test.html\", model); System.out.println(output);\r\n2. System.out.println(tags);\r\n\r\nSo what is being output? Lets take a look...\r\n\r\n    <html>\r\n      <head>\r\n        <title></title>\r\n      </head>\r\n      <body>\r\n        <h1></h1>\r\n        <p>Some text</p>\r\n        <p>Some text</p>\r\n        <p>Some text</p>\r\n        <p>Some more text</p>\r\n        \r\n        <h2>A sub-heading</h2>\r\n        <p>Sub text</p>\r\n        <p>More sub text</p>\r\n        <a href=\"http://www.example.com/\">A Link</a>\r\n      </body>\r\n    </html>\r\n\r\nWe have 3 copies of \"Some text\", plus the \"Some more text\" which was in the original file from our HTML author.  So we need to remove that last P.  Easy enough - add in a data-th-remove=\"all\" attribute.\r\n\r\n        <p data-th-each=\"para : ${section1Paragraphs}\">Some text</p>\r\n        <p data-th-remove=\"all\">Some more text</p>\r\n\r\nRun the test again: Green bar!\r\n\r\n### Should Create Three Paragraphs Under Heading 1 With Expected Content\r\nThat's great but as we saw above, all we are testing for is how many paragraphs are output.  We have not tested for the CONTENT of each paragraph.  So lets add a test in for that now.\r\n\r\n    @Test\r\n    public void shouldCreateThreeParagraphsUnderHeading1WithExpectedContent() throws Exception {\r\n      Map<String,Object> model = new HashMap<String,Object>();\r\n      model.put(\"section1Paragraphs\", Arrays.asList(\"para 1\", \"para 2\", \"para 3\"));\r\n      HtmlElements tags = testEngine.process(\"/html/test.html\", model);\r\n      assertThat(tags.matching(\"body > p:nth-of-type(-n+3)\"), hasOnlyText(\"para 1\", \"para 2\", \"para 3\"));\r\n    }\r\n\r\nSome more CSS3 here: we are asking for the first 3 \"p\" tags.  The p:nth-of-type(-n+3) will select them for us.\r\nNow when we run the test it fails and we get the error message, \r\n\r\n    Expected 3 elements with text [\"para 1\", \"para 2\", \"para 3\"] but: [\"some text\", \"Some text\", \"Some text\"]\r\n\r\nOK so we can add the text in now - with the data-th-text tag.\r\n\r\n        <p data-th-each=\"para : ${section1Paragraphs}\" data-th-text=\"${para}\">Some text</p>\r\n\r\nRun the test again - Green bar! The test passes.\r\n\r\n## A note on Hamcrest\r\nThese test assertions have been designed around the Hamcrest assertion model. For more information see http://hamcrest.org/JavaHamcrest/ and for a handy quick reference see http://www.marcphilipp.de/downloads/posts/2013-01-02-hamcrest-quick-reference/Hamcrest-1.3.pdf\r\n\r\nThymeleaf-TDD adds the following assertions, for testing against the Thymeleaf DOM,\r\n\r\n    import static com.connect_group.thymeleaf.testing.hamcrest.ThymeleafMatchers.*;\r\n    \r\n* exists() returns true if any elements were found\r\n* hasAttribute(\"href\") returns true if the matched element has the named attribute\r\n* hasAttribute(\"href\", \"value\") returns true if the matched element has the named attribute with the given value\r\n* hasChildren() returns true if the matched element has children\r\n* hasClasses(\"class1 class2\") returns true if the matched element has the named class or classes\r\n* hasComment() returns true if the matched element has a HTML comment as a child\r\n* hasCommentWithText(\"expected text\") returns true if the matched element has a comment containing the expected text\r\n* hasOnlyText(\"text\") returns true if the matched element only contains Text and the text is as expected\r\n* hasOnlyText(\"text1\", \"text2\", ...) returns true if all of the matched elements contain only text, and the text is the sequence supplied\r\n* isSingleElementThat() checks that the result is exactly one element and allows you to chain additional matchers.  For example, isSingleElementThat(hasClasses(\"myclass\"))\r\n* occursOnce() returns true if exactly one element was found\r\n\r\n## Thymesheet TDD\r\nUp to now we have been testing Thymeleaf and that is the most common usage of Thymeleaf.  However Thymeleaf-TDD can also be used to test Thymesheet variants of Thymeleaf by including an external TSS stylesheet.\r\n\r\nThere are various methods of including the external file but one simple method is to locate a TSS file within the /src/main/webapp - e.g.\r\n\r\n        <link rel=\"thymesheet\" href=\"thymesheet.tss\" />\r\n\r\nSo we get some HTML as follows,\r\n\r\n    <html>\r\n      <head>\r\n        <title>Lorem Ipsum</title>\r\n        <link rel=\"thymesheet\" href=\"thymesheet.tss\" />\r\n      </head>\r\n      <body>\r\n        <h1>A heading</h1>\r\n        <p>Some text</p>\r\n        <p>Some more text</p>\r\n        \r\n        <h2>A sub-heading</h2>\r\n        <p>Sub text</p>\r\n        <p>More sub text</p>\r\n        <a href=\"http://www.example.com/\">A Link</a>\r\n      </body>\r\n    </html>\r\n\r\nThe same tests as described previously can still be applied, but instead of editing the HTML directly, we add rules to thymesheet.tss.\r\n\r\n### Should Set Title To Expected Value\r\ntitle { th-text: \"${pageTitle}\"; }\r\n\r\n### Should Set Heading To Expected Value\r\nh1 { th-text: \"${heading1}\"; }\r\n\r\n### Should Create Three Paragraphs Under Heading 1\r\nh1 + p { th-each: \"para : ${section1Paragraphs}\"; }\r\nh1 + p + P { th-remove: \"all\"; }\r\n\r\n### Should Create Three Paragraphs Under Heading 1 With Expected Content\r\nh1 + p { th-each: \"para : ${section1Paragraphs}\"; th-text: \"${para}\";}\r\n\r\n\r\n## Configuration\r\nIf your tests require properties you can create a /src/test/resources/test.properties file which will be picked up by the default Spring configuration supplied with thymeleaf-tdd.\r\n\r\nSome specific properties are also supported in the file as follows,\r\n\r\n* thymeleaf.template.webappPath -- defaults to src/main/webapp\r\n* thymeleaf.template.cache.enabled -- defaults to true\r\n* thymeleaf.template.mode -- defaults to LEGACYHTML5\r\n* thymeleaf.template.characterEncoding -- defaults to UTF-8\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}